{"version":3,"sources":["turbopack:///[project]/frontend/src/lib/api.ts","turbopack:///[project]/frontend/src/app/test-login/page.tsx"],"sourcesContent":["// API client for making requests to the backend\r\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3002/api';\r\n\r\n// Get token from localStorage or sessionStorage\r\nconst getToken = () => {\r\n  if (typeof window !== 'undefined') {\r\n    return localStorage.getItem('token') || sessionStorage.getItem('token');\r\n  }\r\n  return null;\r\n};\r\n\r\n// Define types for API responses\r\ninterface User {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  userType: string;\r\n}\r\n\r\ninterface LoginResponse {\r\n  token: string;\r\n  user: User;\r\n}\r\n\r\ninterface RegisterResponse {\r\n  token: string;\r\n  user: User;\r\n}\r\n\r\n// Define a generic type for API responses\r\ntype ApiResponse<T = unknown> = Promise<T>;\r\n\r\n// Helper function to handle fetch errors\r\nconst handleFetchError = async (response: Response) => {\r\n  if (!response.ok) {\r\n    let errorMessage = `HTTP error! status: ${response.status}`;\r\n    try {\r\n      const errorData = await response.json();\r\n      errorMessage = errorData.message || errorMessage;\r\n    } catch (e) {\r\n      // If we can't parse JSON, use the status text\r\n      errorMessage = response.statusText || errorMessage;\r\n    }\r\n    throw new Error(errorMessage);\r\n  }\r\n  return response;\r\n};\r\n\r\nexport const apiClient = {\r\n  // Generic GET request\r\n  get: async <T = unknown>(endpoint: string): ApiResponse<T> => {\r\n    try {\r\n      const token = getToken();\r\n      const response = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...(token && { 'Authorization': `Bearer ${token}` }),\r\n        },\r\n        // Add timeout and credentials for better error handling\r\n        credentials: 'include',\r\n      });\r\n      \r\n      await handleFetchError(response);\r\n      return response.json();\r\n    } catch (error) {\r\n      console.error('API GET request failed:', error);\r\n      // Provide more specific error messages\r\n      if (error instanceof TypeError && error.message === 'Failed to fetch') {\r\n        throw new Error('Network error: Unable to connect to the server. Please check if the server is running.');\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Generic POST request\r\n  post: async <T = unknown>(endpoint: string, data: Record<string, unknown>): ApiResponse<T> => {\r\n    try {\r\n      const token = getToken();\r\n      const response = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...(token && { 'Authorization': `Bearer ${token}` }),\r\n        },\r\n        body: JSON.stringify(data),\r\n        // Add timeout and credentials for better error handling\r\n        credentials: 'include',\r\n      });\r\n      \r\n      await handleFetchError(response);\r\n      return response.json();\r\n    } catch (error) {\r\n      console.error('API POST request failed:', error);\r\n      // Provide more specific error messages\r\n      if (error instanceof TypeError && error.message === 'Failed to fetch') {\r\n        throw new Error('Network error: Unable to connect to the server. Please check if the server is running.');\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Generic PUT request\r\n  put: async <T = unknown>(endpoint: string, data: Record<string, unknown>): ApiResponse<T> => {\r\n    try {\r\n      const token = getToken();\r\n      const response = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...(token && { 'Authorization': `Bearer ${token}` }),\r\n        },\r\n        body: JSON.stringify(data),\r\n        // Add timeout and credentials for better error handling\r\n        credentials: 'include',\r\n      });\r\n      \r\n      await handleFetchError(response);\r\n      return response.json();\r\n    } catch (error) {\r\n      console.error('API PUT request failed:', error);\r\n      // Provide more specific error messages\r\n      if (error instanceof TypeError && error.message === 'Failed to fetch') {\r\n        throw new Error('Network error: Unable to connect to the server. Please check if the server is running.');\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Generic DELETE request\r\n  delete: async <T = unknown>(endpoint: string): ApiResponse<T> => {\r\n    try {\r\n      const token = getToken();\r\n      const response = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n        method: 'DELETE',\r\n        headers: {\r\n          ...(token && { 'Authorization': `Bearer ${token}` }),\r\n        },\r\n        // Add timeout and credentials for better error handling\r\n        credentials: 'include',\r\n      });\r\n      \r\n      await handleFetchError(response);\r\n      return response.json();\r\n    } catch (error) {\r\n      console.error('API DELETE request failed:', error);\r\n      // Provide more specific error messages\r\n      if (error instanceof TypeError && error.message === 'Failed to fetch') {\r\n        throw new Error('Network error: Unable to connect to the server. Please check if the server is running.');\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // File download request\r\n  download: async (endpoint: string): Promise<Blob> => {\r\n    try {\r\n      const token = getToken();\r\n      const response = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n        headers: {\r\n          ...(token && { 'Authorization': `Bearer ${token}` }),\r\n        },\r\n        // Add timeout and credentials for better error handling\r\n        credentials: 'include',\r\n      });\r\n      \r\n      await handleFetchError(response);\r\n      return response.blob();\r\n    } catch (error) {\r\n      console.error('API download request failed:', error);\r\n      // Provide more specific error messages\r\n      if (error instanceof TypeError && error.message === 'Failed to fetch') {\r\n        throw new Error('Network error: Unable to connect to the server. Please check if the server is running.');\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Login method\r\n  login: async (email: string, password: string, userType: string): Promise<LoginResponse> => {\r\n    return apiClient.post<LoginResponse>('/auth/login', { email, password, userType });\r\n  },\r\n\r\n  // Register method\r\n  register: async (name: string, email: string, password: string): Promise<RegisterResponse> => {\r\n    return apiClient.post<RegisterResponse>('/auth/register', { name, email, password });\r\n  },\r\n\r\n  // Get current user\r\n  getCurrentUser: async (): Promise<User> => {\r\n    return apiClient.get<User>('/auth/user/me');\r\n  }\r\n};","'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { apiClient } from '../../lib/api';\r\n\r\ninterface LoginResponse {\r\n  token: string;\r\n  user: {\r\n    id: string;\r\n    name: string;\r\n    email: string;\r\n    userType: string;\r\n  };\r\n}\r\n\r\nconst TestLoginPage = () => {\r\n  const [email, setEmail] = useState('citizen@example.com');\r\n  const [password, setPassword] = useState('password123');\r\n  const [userType, setUserType] = useState('Citizen');\r\n  const [result, setResult] = useState<LoginResponse | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const handleLogin = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const response: LoginResponse = await apiClient.login(email, password, userType);\r\n      setResult(response);\r\n      \r\n      // Store token in localStorage\r\n      if (response.token) {\r\n        localStorage.setItem('token', response.token);\r\n      }\r\n    } catch (err: unknown) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Login failed';\r\n      setError(errorMessage);\r\n      console.error('Login error:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: '20px', fontFamily: 'Arial, sans-serif', maxWidth: '400px', margin: '0 auto' }}>\r\n      <h1>Test Login</h1>\r\n      <form onSubmit={handleLogin} style={{ marginBottom: '20px' }}>\r\n        <div style={{ marginBottom: '15px' }}>\r\n          <label>Email:</label>\r\n          <input\r\n            type=\"email\"\r\n            value={email}\r\n            onChange={(e) => setEmail(e.target.value)}\r\n            style={{ width: '100%', padding: '8px', marginTop: '5px' }}\r\n            required\r\n          />\r\n        </div>\r\n        \r\n        <div style={{ marginBottom: '15px' }}>\r\n          <label>Password:</label>\r\n          <input\r\n            type=\"password\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n            style={{ width: '100%', padding: '8px', marginTop: '5px' }}\r\n            required\r\n          />\r\n        </div>\r\n        \r\n        <div style={{ marginBottom: '15px' }}>\r\n          <label>User Type:</label>\r\n          <select\r\n            value={userType}\r\n            onChange={(e) => setUserType(e.target.value)}\r\n            style={{ width: '100%', padding: '8px', marginTop: '5px' }}\r\n          >\r\n            <option value=\"Citizen\">Citizen</option>\r\n            <option value=\"Officer\">Officer</option>\r\n            <option value=\"Staff\">Staff</option>\r\n          </select>\r\n        </div>\r\n        \r\n        <button \r\n          type=\"submit\"\r\n          disabled={loading}\r\n          style={{ padding: '10px 20px', backgroundColor: '#0070f3', color: 'white', border: 'none', borderRadius: '4px' }}\r\n        >\r\n          {loading ? 'Logging in...' : 'Login'}\r\n        </button>\r\n      </form>\r\n      \r\n      {error && (\r\n        <div style={{ \r\n          backgroundColor: '#fee', \r\n          color: '#c33', \r\n          padding: '10px', \r\n          borderRadius: '4px',\r\n          marginBottom: '20px'\r\n        }}>\r\n          <strong>Error:</strong> {error}\r\n        </div>\r\n      )}\r\n      \r\n      {result && (\r\n        <div style={{ \r\n          backgroundColor: '#efe', \r\n          color: '#363', \r\n          padding: '10px', \r\n          borderRadius: '4px'\r\n        }}>\r\n          <strong>Login Success:</strong>\r\n          <pre>{JSON.stringify(result, null, 2)}</pre>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TestLoginPage;"],"names":[],"mappings":"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"}